<!doctype html>
<head>
    <meta charset="utf-8">
    <title>FILE→SVG</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="./js/psd.min.js"></script>
    <script type="text/javascript" src="./js/snap.svg-min.js"></script>
    <script type="text/javascript" src="./js/fabric.min.js"></script>
    <script type="text/javascript" src="./js/filetosvg.js"></script>
    <script type="text/javascript" src="./js/canvas.js"></script>

    <script type="text/javascript">

        window.addEventListener("DOMContentLoaded", function(){

            //ファイルオープンの際のイベント
            document.getElementById("selectfile").addEventListener("change", function(evt) {

                // ファイルをSVGに変換しCanvasクラスにセットする
                fileToSvg.LoadToSvg(evt.target.files[0], canvas.addObj);

                // 選択されたファイルをクリア
                $('input[type=file]').val('');
            }, false);
        });

        // canvasをSVGに保存する
        function saveSvg(){
            var svgString = canvas.getSvg();

            var blob = new Blob([ svgString ], { "type" : "text/plain" });
            var a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.target = '_blank';
            a.download = 'canvas.svg';
            a.click();
        }
    </script>
</head>
<body>
    <h1>FILE→SVG</h1>
    <div>
        <input type="file" id="selectfile">
        <input type="button" value="ファイルに保存" onClick="saveSvg()">
    </div>
    <div style="margin-top:5px; margin-bottom:5px;">
        <input type="button" id="undo" value="Undo" onClick="canvas.undo()">
        <input type="button" value="Copy" onClick="canvas.copyObj()">
        <input type="button" value="Paste" onClick="canvas.pasteObj()">
        <input type="button" value="Delete" onClick="canvas.deleteOneObj()">
        <input type="button" value="AllDelete" onClick="canvas.deleteAllObj()">
    </div>
    <div style="margin-top:5px; margin-bottom:5px;">
        <input type="button" value="ZoomIn" onClick="canvas.zoomIn()">
        <input type="button" value="ZoomOut" onClick="canvas.zoomOut()">
        <input type="button" value="Load" onClick="canvas.load()">
        <input type="button" value="Save" onClick="canvas.save()">
    </div>
    <canvas id="canvas"style="border:1px solid;"></canvas>
    <script type="text/javascript">
        var fileToSvg = new FileToSvg();
        var canvas = new Canvas('canvas', 1200, 800);
    </script>
</body>
</html>
